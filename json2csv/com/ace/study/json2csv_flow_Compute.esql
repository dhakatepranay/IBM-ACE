BROKER SCHEMA com.ace.study


CREATE COMPUTE MODULE json2csv_flow_Compute
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
		
		CREATE FIELD OutputRoot.DFDL.json2csv.header;
		DECLARE refHeader REFERENCE TO OutputRoot.DFDL.json2csv.header;
		
		SET refHeader.Id      = 'Id';
		SET refHeader.Name    = 'Name';
		SET refHeader.Product = 'Product';
		
		DECLARE I INTEGER 1;
		DECLARE refIN REFERENCE TO InputRoot.JSON.Data.Orders.order.Item[1];
		
		WHILE LASTMOVE(refIN) DO 
			CREATE FIELD OutputRoot.DFDL.json2csv;
			DECLARE refRecord REFERENCE TO OutputRoot.DFDL.json2csv;
			SET refRecord.record[I].Id 		= refIN.Id;
			SET refRecord.record[I].Name 	= refIN.Name;
			SET refRecord.record[I].Product = refIN.Product;
			SET I = I + 1;
		MOVE refIN NEXTSIBLING;
		END WHILE;

		RETURN TRUE;
	END;
END MODULE;
